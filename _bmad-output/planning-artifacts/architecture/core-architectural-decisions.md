# Core Architectural Decisions

## Decision Priority Analysis

**Critical Decisions (Block Implementation):**
- IPC pattern for Rust ↔ React communication
- State management for download queue and UI
- Localization framework for EN/FR support

**Important Decisions (Shape Architecture):**
- Binary bundling strategy for yt-dlp/FFmpeg
- CI/CD pipeline for cross-platform builds

**Deferred Decisions (Post-MVP):**
- Code signing (v1.1 per brainstorming)
- Linux support (not in current scope)

## IPC & Communication

| Decision | Choice | Rationale |
|----------|--------|-----------|
| **IPC Pattern** | Tauri Commands + Events | Commands initiate actions, Events stream progress — native Tauri pattern |
| **Progress Streaming** | Tauri event emitter | Rust emits per-track status, React subscribes |
| **Error Communication** | Structured error types | Rust errors mapped to user-friendly messages in React |

**Implementation Pattern:**

```rust
// Rust: Emit progress events
app.emit("download-progress", ProgressPayload { track_id, status, percent });
```

```typescript
// React: Subscribe to events
listen("download-progress", (event) => updateTrackStatus(event.payload));
```

## Frontend Architecture

| Decision | Choice | Version | Rationale |
|----------|--------|---------|-----------|
| **State Management** | Zustand | latest | Lightweight, TypeScript-friendly, handles frequent updates |
| **Localization** | react-i18next | latest | Industry standard, JSON translation files, future-proof |

**State Structure:**

```typescript
interface AppState {
  auth: { isSignedIn: boolean; username: string | null; };
  queue: { tracks: Track[]; currentIndex: number; };
  settings: { downloadPath: string; language: 'en' | 'fr'; };
}
```

## Binary Management

| Decision | Choice | Rationale |
|----------|--------|-----------|
| **Bundling Strategy** | Tauri Sidecar | Official pattern, platform-specific binary selection |
| **yt-dlp** | Pinned version, checksum verified | NFR11 compliance |
| **FFmpeg** | Pinned version, checksum verified | NFR12 compliance |
| **Binary Location** | App resources folder | Tauri sidecar default |

## Infrastructure & Deployment

| Decision | Choice | Rationale |
|----------|--------|-----------|
| **CI/CD** | GitHub Actions | Free, official Tauri support via tauri-action |
| **Build Targets** | Windows (MSI), macOS (DMG) | Per PRD platform requirements |
| **Release Distribution** | GitHub Releases | Tauri updater integration |
| **Update Manifest** | Auto-generated by tauri-action | Enables in-app update checks |

**Pipeline Structure:**

1. Push to main → Trigger build
2. Build Windows + macOS in parallel
3. Verify binary checksums
4. Create GitHub Release with artifacts
5. Generate updater manifest JSON

## Decision Impact Analysis

**Implementation Sequence:**

1. Project initialization (Tauri + React + Vite)
2. Tailwind + Shadcn/ui setup
3. Zustand store structure
4. react-i18next configuration
5. Tauri sidecar configuration for binaries
6. GitHub Actions workflow

**Cross-Component Dependencies:**

- Zustand store ← Tauri events (progress updates)
- react-i18next ← Settings store (language preference)
- Tauri sidecar ← CI pipeline (binary bundling)
